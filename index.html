<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:10px}
h1{text-align:center;color:#b30000;margin-bottom:5px}
h1 small{display:block;font-size:12px;color:#555}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.section-title{background:#b30000;color:#fff;padding:8px 12px;border-radius:8px;font-size:18px;margin-bottom:10px}
.sub-title{font-weight:bold;color:#b30000;margin:14px 0 8px;padding-bottom:4px;border-bottom:2px solid #b30000}
.item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #eee}
.item:last-child{border-bottom:none}
.name{font-weight:bold}
.desc{font-size:12px;color:#777}
.controls{display:flex;align-items:center;gap:6px}
.controls button{width:30px;height:30px;border:none;border-radius:6px;font-size:18px;color:#fff}
.plus{background:#25D366}
.minus{background:#b30000}
.notice{background:#fff3cd;color:#b30000;padding:10px;border-radius:8px;margin:10px 0;text-align:center;font-size:14px}
</style>
</head>

<body>

<h1>üëë El Rey de las Empanadas
<small>Lunes cerrado ¬∑ Pedidos de 17 a 23 hs</small>
</h1>

<div id="menu">‚è≥ Cargando men√∫...</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
let carrito = {}, total = 0;

const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?gid=0&single=true&output=csv";

let intentos = 0;

function cargarSheet(){
Papa.parse(CSV_URL + "&nocache=" + Date.now(),{
download:true,
header:true,
skipEmptyLines:true,
complete:r=>{
if(!r.data || r.data.length===0){
if(intentos<3){
intentos++;
setTimeout(cargarSheet,800);
}else{
menu.innerHTML="<div class='notice'>‚ùå No se pudo cargar el men√∫</div>";
}
return;
}
renderMenu(r.data);
}
});
}

function renderMenu(data){
let html="";
let actualCat="", actualSub="";

data.forEach(p=>{
if(p.Stock!=="TRUE" && p.Stock!=="true" && p.Stock!=="1") return;

if(p.Categor√≠a!==actualCat){
actualCat=p.Categor√≠a;
actualSub="";
html+=`<div class="card">
<div class="section-title">${actualCat}</div>`;
}

if(p.Subcategoria && p.Subcategoria!==actualSub){
actualSub=p.Subcategoria;
html+=`<div class="sub-title">${actualSub}</div>`;
}

let id=p.Producto.replace(/\s/g,"_");
carrito[id]=0;

html+=`
<div class="item">
<div>
<div class="name">${p.Producto}</div>
<div class="desc">${p.Descripci√≥n||""}</div>
</div>
<div class="controls">
<button class="minus" onclick="chg('${id}',-1,${p.Precio})">‚àí</button>
<span id="${id}">0</span>
<button class="plus" onclick="chg('${id}',1,${p.Precio})">+</button>
</div>
</div>`;
});

html+="</div>";
menu.innerHTML=html || "<div class='notice'>No hay productos disponibles</div>";
}

function chg(id,d,precio){
carrito[id]=Math.max(0,carrito[id]+d);
document.getElementById(id).innerText=carrito[id];
total=0;
for(let k in carrito){
let el=document.getElementById(k);
if(el) total+=carrito[k]*precio;
}
}

cargarSheet();
</script>

</body>
</html>
