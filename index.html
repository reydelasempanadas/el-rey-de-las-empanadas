<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:10px}
h1{text-align:center;color:#b30000}
h1 small{display:block;font-size:12px;color:#555}

.section-title{
 background:#b30000;color:white;padding:8px 12px;
 border-radius:8px;margin:15px 0;font-size:18px
}
.sub-title{
 color:#b30000;font-weight:bold;margin:10px 0 5px;
 border-bottom:1px solid #eee
}
.card{
 background:white;padding:15px;border-radius:12px;
 margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.1)
}
.item{
 display:flex;justify-content:space-between;
 align-items:center;padding:8px 0;border-bottom:1px dashed #eee
}
.item:last-child{border-bottom:none}
.name{font-weight:bold}
.desc{font-size:12px;color:#777;margin-top:2px}
.price{font-size:13px;color:#555}

.controls button{
 width:30px;height:30px;border:none;
 border-radius:6px;font-size:18px;cursor:pointer
}
.plus{background:#25D366;color:white}
.minus{background:#b30000;color:white}

.sin-stock{
 color:red;font-weight:bold;font-size:13px
}

.selector{display:flex;gap:10px;margin:10px 0}
.selector button{
 flex:1;padding:10px;border-radius:8px;
 border:1px solid #ccc
}
.selector button.active{background:#b30000;color:white}

.input-area input,.input-area textarea{
 width:100%;padding:10px;margin:8px 0;
 border-radius:8px;border:1px solid #ccc;
 font-size:15px
}

.total{
 background:white;padding:15px;border-radius:12px;
 box-shadow:0 3px 8px rgba(0,0,0,.15)
}

.notice{
 background:#fff3cd;color:#b30000;
 padding:12px;border-radius:8px;
 text-align:center;font-weight:bold;margin:12px 0
}

/* AJUSTE CAMBIO */
.cambio-box{
 background:#fff3cd;
 border:1px solid #e0a800;
 border-radius:8px;
 padding:8px;
 margin-top:10px
}
.cambio-box input{
 width:100%;
 border:none;
 background:transparent;
 font-size:14px;
 font-weight:normal;
 outline:none
}

.qr-box{
 margin-top:25px;background:#fff;
 border:3px solid #b30000;
 border-radius:14px;padding:20px;text-align:center
}
.qr-box img{width:220px;margin:10px auto;display:block}
.qr-box a{color:#25D366;font-weight:bold;text-decoration:none}

button.send{
 width:100%;padding:15px;
 background:#25D366;color:white;
 font-size:20px;border:none;border-radius:12px
}
</style>
</head>

<body>

<h1>ğŸ‘‘ El Rey de las Empanadas
<small>Delivery 18:30 a 23:00</small>
</h1>

<div id="menu"></div>

<div class="total">
<div class="section-title">ğŸ›’ Resumen</div>
<div id="resumen">Sin productos</div>

<p><b>Total:</b> <span id="total">$0</span></p>

<div id="avisoEnvio" class="notice" style="display:none">
â³ Esperar confirmaciÃ³n del costo total con envÃ­o
</div>

<div class="section-title">ğŸšš Forma de entrega</div>
<div class="selector">
<button id="bMostrador" class="active" onclick="setEntrega('Mostrador')">Mostrador</button>
<button id="bDelivery" onclick="setEntrega('Delivery')">Delivery</button>
</div>

<div class="input-area">
<input id="nombre" placeholder="Nombre">
<input id="direccion" placeholder="DirecciÃ³n" style="display:none">
<textarea id="obsDelivery" placeholder="ğŸ“ Observaciones para delivery" style="display:none"></textarea>
</div>

<div class="section-title">ğŸ’³ Forma de pago</div>
<div class="selector">
<button id="bEfectivo" class="active" onclick="setPago('Efectivo')">Efectivo</button>
<button id="bTransferencia" onclick="setPago('Transferencia')">Transferencia</button>
</div>

<div id="transferNotice" class="notice" style="display:none">
El enlace de transferencia aparecerÃ¡ en WhatsApp. Enviar comprobante.
</div>

<div id="cambioBox" class="cambio-box">
<input id="cambio" placeholder="Â¿NecesitÃ¡s cambio? IndicÃ¡ con cuÃ¡nto pagÃ¡s">
</div>

<button class="send" onclick="enviar()">ğŸ“² Enviar pedido</button>
</div>

<div class="qr-box">
<p>ğŸ“² EscaneÃ¡ para hacer tu pedido</p>
<img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=https://reydelasempanadas.github.io/el-rey-de-las-empanadas/">
<a href="https://reydelasempanadas.github.io/el-rey-de-las-empanadas/" target="_blank">
ğŸ‘‰ Click en el enlace para hacer tu pedido
</a>
</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?output=csv";

let carrito={}, precios={}, total=0, entrega="Mostrador", pago="Efectivo";

fetch(CSV_URL)
.then(r=>r.text())
.then(t=>{
 const rows=t.split("\n").slice(1);
 const data={};

 rows.forEach(l=>{
  const r=l.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)
          .map(v=>v.replace(/^"|"$/g,"").trim());
  let [prod,cat,sub,precio,stock,desc]=r;
  if(!prod||!cat||!sub) return;

  if(!data[cat]) data[cat]={};
  if(!data[cat][sub]) data[cat][sub]=[];

  data[cat][sub].push({
   prod,
   precio:Number(precio)||0,
   stock:stock==="TRUE",
   desc:desc||""
  });
 });

 renderMenu(data);
});

function renderMenu(data){
 let html="";
 Object.keys(data).forEach(cat=>{
  html+=`<div class="card"><div class="section-title">${cat}</div>`;
  Object.keys(data[cat]).forEach(sub=>{
   html+=`<div class="sub-title">${sub}</div>`;
   data[cat][sub].forEach(p=>{
    let id=p.prod.replace(/\s/g,"_");
    carrito[id]=0; precios[id]=p.precio;

    html+=`
    <div class="item">
     <div>
      <div class="name">${p.prod}</div>
      ${p.desc?`<div class="desc">${p.desc}</div>`:""}
      <div class="price">$${p.precio}</div>
      ${!p.stock?'<div class="sin-stock">Sin stock</div>':""}
     </div>
     ${p.stock?`
     <div class="controls">
      <button class="minus" onclick="chg('${id}',-1)">âˆ’</button>
      <span id="${id}">0</span>
      <button class="plus" onclick="chg('${id}',1)">+</button>
     </div>`:""}
    </div>`;
   });
  });
  html+="</div>";
 });
 document.getElementById("menu").innerHTML=html;
}

function chg(id,d){
 carrito[id]=Math.max(0,carrito[id]+d);
 document.getElementById(id).innerText=carrito[id];
 total=0;
 for(let k in carrito) total+=carrito[k]*precios[k];
 document.getElementById("total").innerText=
 entrega==="Delivery"?`$${total} + envÃ­o`:`$${total}`;
}

function setEntrega(t){
 entrega=t;
 bMostrador.classList.toggle("active",t==="Mostrador");
 bDelivery.classList.toggle("active",t==="Delivery");
 direccion.style.display=t==="Delivery"?"block":"none";
 obsDelivery.style.display=t==="Delivery"?"block":"none";
 avisoEnvio.style.display=t==="Delivery"?"block":"none";
}

function setPago(p){
 pago=p;
 bEfectivo.classList.toggle("active",p==="Efectivo");
 bTransferencia.classList.toggle("active",p==="Transferencia");
 transferNotice.style.display=p==="Transferencia"?"block":"none";
 cambioBox.style.display=p==="Transferencia"?"none":"block";
}

function enviar(){
 let msg="ğŸ§¾ *Pedido - El Rey de las Empanadas*%0A%0A";
 for(let k in carrito){
  if(carrito[k]>0) msg+=`â€¢ ${carrito[k]} ${k.replace(/_/g," ")}%0A`;
 }
 if(entrega==="Delivery") msg+="%0AğŸš¨ *SE NECESITA COTIZAR CON ENVÃO*";
 msg+=`%0AğŸ’° Total: $${total}`;
 msg+=`%0AğŸšš Entrega: ${entrega}`;
 if(entrega==="Delivery") msg+=`%0AğŸ“ DirecciÃ³n: ${direccion.value}%0AğŸ“ Obs: ${obsDelivery.value||"â€”"}`;
 msg+=`%0AğŸ‘¤ Nombre: ${nombre.value}`;
 msg+=`%0AğŸ’³ Pago: ${pago}`;
 if(pago==="Efectivo" && cambio.value) msg+=`%0AğŸ’µ Cambio: ${cambio.value}`;
 if(pago==="Transferencia") msg+=`%0AğŸ“ TRANSFERENCIA: Enviar comprobante`;
 window.open("https://wa.me/59892663559?text="+msg);
}
</script>

</body>
</html>
