<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
 font-family:Arial,sans-serif;
 background:#f4f4f4;
 margin:0;
 padding:10px;
}
h1{
 text-align:center;
 color:#b30000;
 margin-bottom:5px;
}
h1 small{
 display:block;
 font-size:12px;
 color:#555;
}
.card{
 background:white;
 padding:15px;
 border-radius:12px;
 margin-bottom:20px;
 box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.section-title{
 background:#b30000;
 color:white;
 padding:8px 12px;
 border-radius:8px;
 margin-bottom:10px;
 font-size:18px;
}
.item{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:8px 0;
 border-bottom:1px dashed #eee;
}
.item:last-child{border-bottom:none}
.name{font-weight:bold}
.desc{font-size:12px;color:#777}
.controls button{
 width:30px;
 height:30px;
 border:none;
 border-radius:6px;
 font-size:18px;
 cursor:pointer;
}
.plus{background:#25D366;color:white}
.minus{background:#b30000;color:white}
.disabled{
 opacity:.4;
 pointer-events:none;
}
.no-stock{
 color:#b30000;
 font-size:12px;
 font-weight:bold;
}
.total{
 background:white;
 padding:15px;
 border-radius:12px;
 box-shadow:0 3px 8px rgba(0,0,0,.15);
}
.send{
 width:100%;
 padding:15px;
 background:#25D366;
 color:white;
 font-size:20px;
 border:none;
 border-radius:12px;
 margin-top:10px;
}
</style>
</head>

<body>

<h1>ðŸ‘‘ El Rey de las Empanadas
<small>Pedidos online</small>
</h1>

<div id="menu"></div>

<div class="total">
<div class="section-title">ðŸ›’ Resumen</div>
<div id="resumen"><small>No hay productos seleccionados</small></div>
<p><b>Total:</b> $<span id="total">0</span></p>
<button class="send" onclick="enviar()">ðŸ“² Enviar pedido</button>
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?output=csv";

let carrito = {};
let precios = {};
let total = 0;

function idify(txt){
 return txt.replace(/\s+/g,'_').replace(/[^\w]/g,'').toLowerCase();
}

fetch(SHEET_URL)
 .then(r=>r.text())
 .then(csv=>{
  const rows = csv.split("\n").map(r=>r.split(","));
  const headers = rows[0].map(h=>h.toLowerCase().trim());

  const idx = {
    producto: headers.indexOf("producto"),
    categoria: headers.indexOf("categorÃ­a"),
    precio: headers.indexOf("precio"),
    stock: headers.indexOf("stock"),
    descripcion: headers.indexOf("descripciÃ³n")
  };

  const data = rows.slice(1).map(r=>({
    producto:r[idx.producto],
    categoria:r[idx.categoria],
    precio:parseInt(r[idx.precio]),
    stock:r[idx.stock]?.toLowerCase()=="true",
    descripcion:r[idx.descripcion]
  }));

  renderMenu(data);
 });

function renderMenu(data){
 const menu = document.getElementById("menu");
 const categorias = [...new Set(data.map(p=>p.categoria))];

 categorias.forEach(cat=>{
  const card = document.createElement("div");
  card.className="card";
  card.innerHTML=`<div class="section-title">${cat}</div>`;

  data.filter(p=>p.categoria==cat).forEach(p=>{
   const pid = idify(p.producto);
   carrito[pid]=0;
   precios[pid]=p.precio;

   const item = document.createElement("div");
   item.className="item"+(p.stock?"":" disabled");

   item.innerHTML=`
    <div>
     <div class="name">${p.producto}</div>
     <div class="desc">${p.descripcion||""}</div>
     ${p.stock?`<small>$${p.precio}</small>`:`<div class="no-stock">No disponible</div>`}
    </div>
    <div class="controls">
     <button class="minus" onclick="chg('${pid}',-1)">âˆ’</button>
     <span id="${pid}">0</span>
     <button class="plus" onclick="chg('${pid}',1)">+</button>
    </div>
   `;
   card.appendChild(item);
  });
  menu.appendChild(card);
 });
}

function chg(id,d){
 carrito[id]+=d;
 if(carrito[id]<0) carrito[id]=0;
 document.getElementById(id).innerText=carrito[id];

 total=0;
 for(let k in carrito) total+=carrito[k]*precios[k];
 document.getElementById("total").innerText=total;
 resumen();
}

function resumen(){
 let r="";
 for(let k in carrito){
  if(carrito[k]>0) r+=`${carrito[k]} ${k.replace(/_/g," ")}<br>`;
 }
 document.getElementById("resumen").innerHTML=r||"<small>No hay productos seleccionados</small>";
}

function enviar(){
 if(total==0){ alert("Seleccione productos"); return; }
 let msg="ðŸ§¾ Pedido%0A%0A";
 for(let k in carrito){
  if(carrito[k]>0) msg+=`â€¢ ${carrito[k]} ${k.replace(/_/g," ")}%0A`;
 }
 msg+=`%0AðŸ’° Total: $${total}`;
 window.open("https://wa.me/59892663559?text="+msg);
}
</script>

</body>
</html>
