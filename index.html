<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
 font-family:Arial,sans-serif;
 background:#f4f4f4;
 margin:0;
 padding:10px;
}
h1{text-align:center;color:#b30000}
h1 small{display:block;font-size:12px;color:#555}

.card{
 background:white;
 padding:15px;
 border-radius:12px;
 margin-bottom:20px;
 box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.section-title{
 background:#b30000;
 color:white;
 padding:8px 12px;
 border-radius:8px;
 margin-bottom:10px;
 font-size:18px;
}
.item{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:8px 0;
 border-bottom:1px dashed #eee;
}
.item:last-child{border-bottom:none}
.name{font-weight:bold}
.desc{font-size:12px;color:#777}
.controls button{
 width:30px;height:30px;border:none;
 border-radius:6px;font-size:18px;cursor:pointer
}
.plus{background:#25D366;color:white}
.minus{background:#b30000;color:white}
.disabled{opacity:.4;pointer-events:none}
.no-stock{color:#b30000;font-weight:bold;font-size:12px}

.selector{
 display:flex;gap:10px;margin:10px 0
}
.selector button{
 flex:1;padding:10px;font-size:16px;
 border-radius:8px;border:1px solid #ccc;
 background:#eee;cursor:pointer
}
.selector button.active{
 background:#b30000;color:white
}

.input-area input,.input-area textarea{
 width:100%;padding:10px;margin:6px 0;
 font-size:16px;border-radius:6px;
 border:none;background:#fff3cd
}

.notice{
 background:#fff3cd;
 color:#856404;
 padding:10px;
 border-radius:8px;
 margin:10px 0;
 font-size:14px
}

.total{
 background:white;
 padding:15px;
 border-radius:12px;
 box-shadow:0 3px 8px rgba(0,0,0,.15)
}
.send{
 width:100%;padding:15px;
 background:#25D366;color:white;
 font-size:20px;border:none;
 border-radius:12px;margin-top:10px
}
</style>
</head>

<body>

<h1>ðŸ‘‘ El Rey de las Empanadas
<small>Delivery 18:30 a 23:00</small>
</h1>

<div id="menu"></div>

<div class="total">
<div class="section-title">ðŸ›’ Resumen</div>
<div id="resumen"><small>No hay productos</small></div>
<p><b>Total:</b> $<span id="total">0</span></p>

<div class="section-title">ðŸšš Forma de entrega</div>
<div class="selector">
<button id="btnMostrador" class="active" onclick="setEntrega('Mostrador')">Mostrador</button>
<button id="btnDelivery" onclick="setEntrega('Delivery')">Delivery</button>
</div>

<div class="input-area">
<input id="nombre" placeholder="Nombre">
<input id="direccion" placeholder="DirecciÃ³n" style="display:none">
<textarea id="observaciones" placeholder="Observaciones" style="display:none"></textarea>
</div>

<div class="section-title">ðŸ’³ Forma de pago</div>
<div class="selector">
<button id="btnEfectivo" class="active" onclick="setPago('Efectivo')">Efectivo</button>
<button id="btnTransferencia" onclick="setPago('Transferencia')">Transferencia</button>
</div>

<div id="cambioBox" class="notice">
<b>Â¿Necesita cambio?</b>
<input id="cambio" placeholder="Ej: cambio para $1000">
</div>

<div id="transferNotice" class="notice" style="display:none">
El enlace de transferencia se envÃ­a por WhatsApp
</div>

<button class="send" onclick="enviar()">ðŸ“² Enviar pedido</button>
</div>

<script>
const SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?output=csv";

let carrito={},precios={},total=0;
let entrega="Mostrador",pago="Efectivo";

function idify(t){return t.replace(/\s+/g,"_").replace(/[^\w]/g,"").toLowerCase()}

fetch(SHEET_URL).then(r=>r.text()).then(csv=>{
 const rows=csv.split("\n").map(r=>r.split(","));
 const h=rows[0].map(x=>x.trim().toLowerCase());

 const i={
  p:h.indexOf("producto"),
  c:h.indexOf("categorÃ­a"),
  pr:h.indexOf("precio"),
  s:h.indexOf("stock"),
  d:h.indexOf("descripciÃ³n")
 };

 const data=rows.slice(1).map(r=>({
  producto:r[i.p],
  categoria:r[i.c],
  precio:parseInt(r[i.pr]),
  stock:r[i.s]?.toLowerCase()=="true",
  descripcion:r[i.d]||""
 }));

 render(data);
});

function render(data){
 const menu=document.getElementById("menu");
 const cats=[...new Set(data.map(x=>x.categoria))];

 cats.forEach(cat=>{
  const card=document.createElement("div");
  card.className="card";
  card.innerHTML=`<div class="section-title">${cat}</div>`;

  data.filter(x=>x.categoria==cat).forEach(p=>{
   const id=idify(p.producto);
   carrito[id]=0; precios[id]=p.precio;

   const div=document.createElement("div");
   div.className="item"+(p.stock?"":" disabled");
   div.innerHTML=`
    <div>
     <div class="name">${p.producto}</div>
     <div class="desc">${p.descripcion}</div>
     ${p.stock?`<small>$${p.precio}</small>`:`<div class="no-stock">No disponible</div>`}
    </div>
    <div class="controls">
     <button class="minus" onclick="chg('${id}',-1)">âˆ’</button>
     <span id="${id}">0</span>
     <button class="plus" onclick="chg('${id}',1)">+</button>
    </div>`;
   card.appendChild(div);
  });
  menu.appendChild(card);
 });
}

function chg(id,d){
 carrito[id]+=d;
 if(carrito[id]<0)carrito[id]=0;
 document.getElementById(id).innerText=carrito[id];
 total=Object.keys(carrito).reduce((s,k)=>s+carrito[k]*precios[k],0);
 document.getElementById("total").innerText=total;
 resumen();
}

function resumen(){
 let r="";
 for(let k in carrito) if(carrito[k]>0) r+=`${carrito[k]} ${k.replace(/_/g," ")}<br>`;
 document.getElementById("resumen").innerHTML=r||"<small>No hay productos</small>";
}

function setEntrega(t){
 entrega=t;
 btnMostrador.classList.toggle("active",t=="Mostrador");
 btnDelivery.classList.toggle("active",t=="Delivery");
 direccion.style.display=t=="Delivery"?"block":"none";
 observaciones.style.display=t=="Delivery"?"block":"none";
}

function setPago(p){
 pago=p;
 btnEfectivo.classList.toggle("active",p=="Efectivo");
 btnTransferencia.classList.toggle("active",p=="Transferencia");
 transferNotice.style.display=p=="Transferencia"?"block":"none";
}

function enviar(){
 if(total==0)return alert("Seleccione productos");
 if(!nombre.value)return alert("Ingrese nombre");
 if(entrega=="Delivery"&&!direccion.value)return alert("Ingrese direcciÃ³n");

 let msg="ðŸ§¾ Pedido%0A";
 for(let k in carrito) if(carrito[k]>0) msg+=`â€¢ ${carrito[k]} ${k.replace(/_/g," ")}%0A`;
 msg+=`%0AðŸ’° Total $${total}`;
 msg+=`%0AðŸšš ${entrega}`;
 msg+=`%0AðŸ’³ ${pago}`;
 if(cambio.value) msg+=`%0AðŸ’µ Cambio: ${cambio.value}`;

 window.open("https://wa.me/59892663559?text="+msg);
}
</script>

</body>
</html>
