<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:10px}
h1{text-align:center;color:#b30000}
small{color:#555}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.section{background:#b30000;color:#fff;padding:8px;border-radius:8px;margin-bottom:10px}
.sub{font-weight:bold;color:#b30000;margin-top:10px;border-bottom:1px solid #eee}
.item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #eee}
.item:last-child{border-bottom:none}
.name{font-weight:bold}
.desc{font-size:12px;color:#777}
.controls button{width:30px;height:30px;border:none;border-radius:6px;font-size:18px}
.plus{background:#25D366;color:#fff}
.minus{background:#b30000;color:#fff}
.stockoff{color:red;font-weight:bold}
.selector{display:flex;gap:10px;margin:8px 0}
.selector button{flex:1;padding:10px;border-radius:8px;border:1px solid #ccc}
.active{background:#b30000;color:#fff}
.notice{background:#fff3cd;color:#b30000;padding:10px;border-radius:6px;font-weight:bold;margin:8px 0}
.send{width:100%;padding:15px;font-size:20px;background:#25D366;color:white;border:none;border-radius:12px}
input,textarea{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
</style>
</head>

<body>

<h1>ğŸ‘‘ El Rey de las Empanadas<br><small>Delivery 18:30â€“23:00 | Mostrador 17:00â€“23:00</small></h1>

<div id="menu"></div>

<div class="card">
<div class="section">ğŸ›’ Resumen</div>
<div id="resumen">No hay productos</div>
<p><b>Total:</b> <span id="total">$0</span></p>

<div id="envioAviso" class="notice" style="display:none">
ğŸš¨ ESPERAR COSTO TOTAL CON ENVÃO
</div>

<div class="section">ğŸšš Entrega</div>
<div class="selector">
<button id="bMostrador" class="active" onclick="setEntrega('Mostrador')">Mostrador</button>
<button id="bDelivery" onclick="setEntrega('Delivery')">Delivery</button>
</div>

<input id="nombre" placeholder="Nombre">
<input id="direccion" placeholder="DirecciÃ³n" style="display:none">
<textarea id="obs" placeholder="Observaciones" style="display:none"></textarea>

<div class="section">ğŸ’³ Pago</div>
<div class="selector">
<button id="bEfe" class="active" onclick="setPago('Efectivo')">Efectivo</button>
<button id="bTrans" onclick="setPago('Transferencia')">Transferencia</button>
</div>

<input id="cambio" placeholder="Â¿Necesita cambio?">
<div id="transf" class="notice" style="display:none">
Transferencia se coordina por WhatsApp
</div>

<button class="send" onclick="enviar()">ğŸ“² Enviar por WhatsApp</button>
</div>

<script>
const csvURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?output=csv";
let data=[],cart={},total=0,entrega="Mostrador",pago="Efectivo";

fetch(csvURL).then(r=>r.text()).then(t=>{
 const rows=t.trim().split("\n").slice(1);
 rows.forEach(r=>{
  const [p,c,s,pr,st,d]=r.split(",");
  data.push({p,c,s,pr:+pr,st:st==="TRUE",d});
 });
 render();
});

function render(){
 let html="",cat="",sub="";
 data.forEach(i=>{
  if(i.c!==cat){cat=i.c;html+=`<div class="card"><div class="section">${cat}</div>`}
  if(i.s!==sub){sub=i.s;html+=`<div class="sub">${sub}</div>`}
  const id=i.p.replace(/\s/g,"_");
  cart[id]=0;
  html+=`
  <div class="item">
   <div>
    <div class="name">${i.p}</div>
    <div class="desc">${i.d||""}</div>
    <small>$${i.pr}</small>
    ${!i.st?'<div class="stockoff">Sin stock</div>':""}
   </div>
   <div class="controls">
    <button class="minus" ${!i.st?"disabled":""} onclick="chg('${id}',-1,${i.pr})">âˆ’</button>
    <span id="${id}">0</span>
    <button class="plus" ${!i.st?"disabled":""} onclick="chg('${id}',1,${i.pr})">+</button>
   </div>
  </div>`;
 });
 menu.innerHTML=html;
}

function chg(id,d,p){
 cart[id]=Math.max(0,(cart[id]||0)+d);
 document.getElementById(id).innerText=cart[id];
 total=0;
 let r="";
 for(let k in cart) if(cart[k]>0){total+=cart[k]*p;r+=`${cart[k]} ${k.replace(/_/g," ")}<br>`}
 resumen.innerHTML=r||"No hay productos";
 totalSpan();
}

function totalSpan(){
 total.innerText=entrega==="Delivery"?`$${total} + envÃ­o`:`$${total}`;
 envioAviso.style.display=entrega==="Delivery"?"block":"none";
}

function setEntrega(t){
 entrega=t;
 bMostrador.classList.toggle("active",t==="Mostrador");
 bDelivery.classList.toggle("active",t==="Delivery");
 direccion.style.display=obs.style.display=t==="Delivery"?"block":"none";
 totalSpan();
}

function setPago(p){
 pago=p;
 bEfe.classList.toggle("active",p==="Efectivo");
 bTrans.classList.toggle("active",p==="Transferencia");
 cambio.style.display=p==="Efectivo"?"block":"none";
 transf.style.display=p==="Transferencia"?"block":"none";
}

function enviar(){
 if(total===0)return alert("SeleccionÃ¡ productos");
 let msg="ğŸ§¾ *Pedido El Rey de las Empanadas*\n\n";
 for(let k in cart) if(cart[k]>0) msg+=`â€¢ ${cart[k]} ${k.replace(/_/g," ")}\n`;
 msg+=`\nğŸ’° Total: $${total}`;
 if(entrega==="Delivery") msg+=`\nğŸš¨ SE NECESITA COTIZAR CON ENVÃO`;
 window.open("https://wa.me/59892663559?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>
