<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:10px}
h1{text-align:center;color:#b30000;margin-bottom:5px}
h1 small{display:block;font-size:12px;color:#555}

.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.section-title{background:#b30000;color:#fff;padding:8px 12px;border-radius:8px;font-size:18px;margin-bottom:10px}
.sub-title{font-weight:bold;color:#b30000;margin:12px 0 6px;border-bottom:1px solid #eee}

.item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #eee}
.item:last-child{border-bottom:none}

.name{font-weight:bold}
.desc{font-size:12px;color:#777}
.sin-stock{color:#b30000;font-weight:bold;font-size:13px}

.controls{display:flex;align-items:center;gap:6px}
.controls button{width:30px;height:30px;border:none;border-radius:6px;font-size:18px;color:#fff}
.controls button:disabled{background:#ccc}

.plus{background:#25D366}
.minus{background:#b30000}
</style>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>

<h1>üëë El Rey de las Empanadas
<small>Lunes cerrado ¬∑ Pedidos de 17 a 23 hs</small>
</h1>

<div id="menu"></div>

<script>
const menu = document.getElementById("menu");

let carrito = {}, precios = {}, total = 0;
let productos = {};

const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?output=csv";

Papa.parse(CSV_URL,{
  download:true,
  header:true,
  skipEmptyLines:true,
  complete:(res)=>{
    productos = {};
    carrito = {};
    precios = {};

    res.data.forEach(f=>{
      if(!f.Producto) return;

      const stockRaw = String(f.Stock).toUpperCase();
      const enStock = (stockRaw === "TRUE" || stockRaw === "VERDADERO" || stockRaw === "1");

      const cat = f["Categor√≠a"]?.trim() || "Otros";
      const sub = (f.Subcategoria || "").trim();

      if(!productos[cat]) productos[cat] = {};
      if(!productos[cat][sub]) productos[cat][sub] = [];

      productos[cat][sub].push({
        nombre: f.Producto.trim(),
        desc: f.Descripci√≥n || "",
        precio: Number(f.Precio) || 0,
        stock: enStock
      });
    });

    render();
  }
});

function render(){
  let h = "";

  Object.keys(productos).forEach(cat=>{
    h += `<div class="card">
            <div class="section-title">${cat}</div>`;

    Object.keys(productos[cat]).forEach(sub=>{
      if(sub) h += `<div class="sub-title">${sub}</div>`;

      productos[cat][sub].forEach(p=>{
        const id = p.nombre.replace(/\s+/g,"_");

        carrito[id] = 0;
        precios[id] = p.precio;

        h += `
        <div class="item">
          <div>
            <div class="name">${p.nombre}</div>
            <div class="desc">${p.desc}</div>
            ${!p.stock ? `<div class="sin-stock">‚ùå Sin stock</div>` : ""}
          </div>
          <div class="controls">
            <button class="minus" ${!p.stock?"disabled":""} onclick="chg('${id}',-1)">‚àí</button>
            <span id="${id}">0</span>
            <button class="plus" ${!p.stock?"disabled":""} onclick="chg('${id}',1)">+</button>
          </div>
        </div>`;
      });
    });

    h += `</div>`;
  });

  menu.innerHTML = h || "<div class='card'>No hay productos cargados</div>";
}

function chg(id,d){
  carrito[id] = Math.max(0, carrito[id] + d);
  document.getElementById(id).innerText = carrito[id];

  total = 0;
  for(let k in carrito){
    total += carrito[k] * (precios[k] || 0);
  }
}
</script>

</body>
</html>
