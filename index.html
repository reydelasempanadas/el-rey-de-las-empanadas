<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:10px}
h1{text-align:center;color:#b30000;margin-bottom:5px}
h1 small{display:block;font-size:12px;color:#555}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.section-title{background:#b30000;color:#fff;padding:8px 12px;border-radius:8px;font-size:18px;margin-bottom:10px}
.sub-title{font-weight:bold;color:#b30000;margin:12px 0 6px;border-bottom:1px solid #eee}
.item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #eee}
.item:last-child{border-bottom:none}
.name{font-weight:bold}
.desc{font-size:12px;color:#777}
.controls{display:flex;align-items:center;gap:6px}
.controls button{width:30px;height:30px;border:none;border-radius:6px;font-size:18px;color:#fff}
.plus{background:#25D366}
.minus{background:#b30000}
.selector{display:flex;gap:10px;margin:10px 0}
.selector button{flex:1;padding:10px;border-radius:8px;border:1px solid #ccc;background:#eee}
.selector button.active{background:#b30000;color:#fff}
.notice{background:#fff3cd;color:#b30000;padding:10px;border-radius:8px;margin:10px 0;text-align:center;font-size:14px}
.input-area input,.input-area textarea{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
button.send{width:100%;padding:15px;background:#25D366;color:#fff;font-size:18px;border:none;border-radius:12px;margin-top:10px}
</style>
</head>

<body>

<h1>üëë El Rey de las Empanadas
<small>Lunes cerrado ¬∑ Pedidos de 17 a 23 hs</small>
</h1>

<div id="menu"></div>

<div class="card">
<div class="section-title">üõí Resumen del pedido</div>
<div id="resumen"><small>No hay productos seleccionados</small></div>
<p><b>Total:</b> $<span id="total">0</span></p>

<div id="avisoEnvio" class="notice" style="display:none">
‚è≥ ATENCI√ìN: enviar costo total con delivery
</div>

<div class="section-title">üöö Forma de entrega</div>
<div class="selector">
<button id="btnMostrador" class="active" onclick="setEntrega('Mostrador')">Retiro</button>
<button id="btnDelivery" onclick="setEntrega('Delivery')">Delivery</button>
</div>

<div class="input-area">
<input id="nombre" placeholder="Nombre">
<input id="direccion" placeholder="Direcci√≥n" style="display:none">
<textarea id="observaciones" placeholder="Observaciones" style="display:none"></textarea>
</div>

<div class="section-title">üí≥ Forma de pago</div>
<div class="selector">
<button id="btnEfectivo" class="active" onclick="setPago('Efectivo')">Efectivo</button>
<button id="btnTransferencia" onclick="setPago('Transferencia')">Transferencia</button>
</div>

<div id="transferNotice" class="notice" style="display:none">
‚ÄºÔ∏è ATENCI√ìN: enviar enlace de transferencia
</div>

<button class="send" onclick="enviar()">üì≤ Enviar pedido</button>
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?gid=0&single=true&output=csv";

let productos = [];
let carrito = {};
let entrega = "Mostrador";
let pago = "Efectivo";

Papa.parse(SHEET_URL,{
  download:true,
  header:true,
  skipEmptyLines:true,
  complete: res=>{
    productos = res.data.map(p=>({
      producto: p.Producto?.trim(),
      categoria: p.Categor√≠a?.trim() || p.Categoria?.trim(),
      subcategoria: p.Subcategoria?.trim(),
      precio: Number(p.Precio),
      disponible: String(p.Disponible).toUpperCase()==="TRUE",
      descripcion: p.Descripci√≥n?.trim()
    })).filter(p=>p.disponible);

    renderMenu();
  }
});

function renderMenu(){
  let html = "";
  const cats = [...new Set(productos.map(p=>p.categoria))];

  cats.forEach(cat=>{
    html+=`<div class="card"><div class="section-title">${cat}</div>`;
    const subs = [...new Set(productos.filter(p=>p.categoria===cat).map(p=>p.subcategoria))];

    subs.forEach(sub=>{
      if(sub) html+=`<div class="sub-title">${sub}</div>`;
      productos.filter(p=>p.categoria===cat && p.subcategoria===sub).forEach(p=>{
        const id = p.producto.replace(/\s/g,"_");
        carrito[id]=carrito[id]||{cant:0,precio:p.precio};

        html+=`
        <div class="item">
          <div>
            <div class="name">${p.producto} - $${p.precio}</div>
            <div class="desc">${p.descripcion||""}</div>
          </div>
          <div class="controls">
            <button class="minus" onclick="chg('${id}',-1)">‚àí</button>
            <span id="${id}">${carrito[id].cant}</span>
            <button class="plus" onclick="chg('${id}',1)">+</button>
          </div>
        </div>`;
      });
    });
    html+="</div>";
  });

  menu.innerHTML = html;
}

function chg(id,d){
  carrito[id].cant = Math.max(0,carrito[id].cant + d);
  document.getElementById(id).innerText = carrito[id].cant;
  resumen();
}

function resumen(){
  let r="",total=0;
  for(let k in carrito){
    if(carrito[k].cant){
      r+=`${carrito[k].cant} ${k.replace(/_/g," ")}<br>`;
      total+=carrito[k].cant*carrito[k].precio;
    }
  }
  resumen.innerHTML = r||"<small>No hay productos seleccionados</small>";
  document.getElementById("total").innerText = total;
}

function setEntrega(t){
  entrega=t;
  btnMostrador.classList.toggle("active",t==="Mostrador");
  btnDelivery.classList.toggle("active",t==="Delivery");
  direccion.style.display = observaciones.style.display = avisoEnvio.style.display = t==="Delivery"?"block":"none";
}

function setPago(p){
  pago=p;
  btnEfectivo.classList.toggle("active",p==="Efectivo");
  btnTransferencia.classList.toggle("active",p==="Transferencia");
  transferNotice.style.display = p==="Transferencia"?"block":"none";
}

function enviar(){
  let total=document.getElementById("total").innerText;
  if(!total||!nombre.value) return alert("Completar pedido");
  let msg="üßæ *Pedido El Rey de las Empanadas*%0A";
  for(let k in carrito) if(carrito[k].cant) msg+=`‚Ä¢ ${carrito[k].cant} ${k.replace(/_/g," ")}%0A`;
  msg+=`%0Aüí∞ Total: $${total}`;
  if(entrega==="Delivery") msg+=`%0A‚ö†Ô∏è ATENCI√ìN: enviar costo con delivery`;
  if(pago==="Transferencia") msg+=`%0A‚ÄºÔ∏è ATENCI√ìN: enviar enlace transferencia`;

  window.open("https://wa.me/59892663559?text="+msg,"_blank");
}
</script>

</body>
</html>
