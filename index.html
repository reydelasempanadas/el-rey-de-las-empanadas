<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>El Rey de las Empanadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
 font-family:Arial,sans-serif;
 background:#f4f4f4;
 margin:0;
 padding:10px;
}
h1{
 text-align:center;
 color:#b30000;
 margin-bottom:5px;
}
h1 small{
 display:block;
 font-size:12px;
 color:#555;
}
.section-title{
 background:#b30000;
 color:white;
 padding:8px 12px;
 border-radius:8px;
 margin-bottom:10px;
 font-size:18px;
}
.card{
 background:white;
 padding:15px;
 border-radius:12px;
 margin-bottom:20px;
 box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.item{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:8px 0;
 border-bottom:1px dashed #eee;
}
.item:last-child{border-bottom:none}
.name{font-weight:bold;font-size:15px}
.desc{font-size:12px;color:#777}
.controls button{
 width:30px;height:30px;border:none;border-radius:6px;
 font-size:18px;cursor:pointer
}
.plus{background:#25D366;color:white}
.minus{background:#b30000;color:white}
.total{
 background:white;padding:15px;border-radius:12px;
 box-shadow:0 3px 8px rgba(0,0,0,.15)
}
.send{
 width:100%;padding:15px;background:#25D366;
 color:white;font-size:20px;border:none;border-radius:12px
}
</style>
</head>

<body>

<h1>ðŸ‘‘ El Rey de las Empanadas
<small>Horario: 17:00 a 23:00 | Lunes cerrado</small>
</h1>

<div id="menu"></div>

<div class="total">
<h3>ðŸ›’ Resumen</h3>
<div id="resumen"><small>No hay productos</small></div>
<b>Total: $<span id="total">0</span></b>
<br><br>
<button class="send" onclick="enviar()">ðŸ“² Enviar pedido</button>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3xILJU5RgaRD9FvVA-gcr9su-QtH15Qs9JR8MYzHxxO2GZLrCzQvlG_rWCqoTmIx87-BtX9Ki8v6V/pub?gid=0&single=true&output=csv";

let carrito = {};
let precios = {};
let total = 0;

function idify(t){
 return t.replace(/\s+/g,'_').replace(/[^\w]/g,'');
}

fetch(CSV_URL)
.then(r => r.text())
.then(csv => {
 const rows = csv.split("\n").slice(1);
 const data = {};

 rows.forEach(r => {
   const [producto,categoria,precio,stock,desc] = r.split(",");
   if(stock?.trim() !== "Disponible") return;

   if(!data[categoria]) data[categoria] = [];
   data[categoria].push({
     producto,
     precio: parseInt(precio),
     desc: desc || ""
   });
 });

 renderMenu(data);
});

function renderMenu(data){
 let html = "";

 Object.keys(data).forEach(cat=>{
   html += `<div class="card"><div class="section-title">${cat}</div>`;
   data[cat].forEach(p=>{
     const id = idify(p.producto);
     carrito[id]=0;
     precios[id]=p.precio;

     html += `
     <div class="item">
      <div>
       <div class="name">${p.producto}</div>
       <div class="desc">${p.desc}</div>
       <small>$${p.precio}</small>
      </div>
      <div class="controls">
       <button class="minus" onclick="chg('${id}',-1)">âˆ’</button>
       <span id="${id}">0</span>
       <button class="plus" onclick="chg('${id}',1)">+</button>
      </div>
     </div>`;
   });
   html += "</div>";
 });

 document.getElementById("menu").innerHTML = html;
}

function chg(id,d){
 carrito[id]+=d;
 if(carrito[id]<0) carrito[id]=0;
 document.getElementById(id).innerText = carrito[id];

 total = 0;
 let resumen = "";
 for(let k in carrito){
   if(carrito[k]>0){
     total += carrito[k]*precios[k];
     resumen += `${carrito[k]} ${k.replace(/_/g,' ')}<br>`;
   }
 }
 document.getElementById("total").innerText = total;
 document.getElementById("resumen").innerHTML = resumen || "<small>No hay productos</small>";
}

function enviar(){
 if(total==0){alert("AgregÃ¡ productos");return;}
 let msg="Pedido:%0A";
 for(let k in carrito){
  if(carrito[k]>0) msg+=`${carrito[k]} ${k.replace(/_/g,' ')}%0A`;
 }
 msg+=`Total: $${total}`;
 window.open("https://wa.me/59892663559?text="+msg,"_blank");
}
</script>

</body>
</html>
